# Proven Fact 알고리즘 완전 가이드

## 📚 개요

이 구현은 **"Proven fact-based algorithm for AI training and high-purity data generation"** 논문의 알고리즘을 완전히 재현한 Python 코드입니다.

### 핵심 차별점

기존 AI 학습 방법:
```
"A는 B이다" (결론만 암기)
```

이 알고리즘:
```
"A는 B이다. 왜냐하면 C이기 때문이다" (인과관계 학습)
```

### 논문의 실험 결과

| 실험 | 엔진 | 총 문장 수 | 환각 발생 | 최종 환각률 |
|------|------|-----------|---------|------------|
| 지구 자전 (1) | ChatGPT | 192 | 0 | **0.00%** |
| 지구 자전 (2) | Claude | 532 | 0 | **0.00%** |
| 지구 구형 (1) | ChatGPT | 316 | 0 | **0.00%** |
| 지구 구형 (2) | Claude | 220 | 4 | **1.8%** |

**평균 환각률: 0.45%** (기존 방법 대비 95%+ 감소)

---

## 🎯 시스템 구조

### 1. 페르소나 구성

#### 교수 (Professor)
```python
역할:
- 과학적으로 입증된 사실(Anchor)만 가르침
- 학생의 질문에 논리적 증거로 답변
- "A는 B이다. 왜냐하면 C이기 때문"의 형식
- 100% 정확성 요구 (초엄격 검증)

특징:
- 전공 분야별 전문성
- 최소 증거로 진리 증명
- 숫자, 단위, 고유명사 정밀 검증
```

#### 학생 (Student)
```python
역할:
- 교수에게 질문하고 도전
- 역사적으로 문서화된 반론 제기
- 논리의 한계 테스트
- 납득하면 명시적으로 인정

특징:
- 회의적 태도 (설정 가능)
- 반증 불가능한 가설 금지
- 수정 시 명시적 철회 필수
```

#### 심판 (Referee)
```python
역할:
- 실시간 환각 감지
- 사실 정확성, 논리 타당성 검증
- 교수 발언: 초엄격 (미세 오류도 포착)
- 학생 발언: 중간 (반증 불가능 주장 차단)

특징:
- 독립적 비동기 리셋
- 소수 기반 리셋 주기
- 교차 검증
```

#### 검증 전문가 (Validation Specialist)
```python
역할:
- 전체 시뮬레이션 최종 감사
- 심판이 놓친 잔여 환각 포착
- 데이터 품질 최종 평가

특징:
- 마지막 방어선
- 전사 검토
- 품질 등급 부여
```

### 2. 비동기 리셋 메커니즘

**문제점**: 모든 심판이 동시에 리셋되면 감시 공백 발생

**해결책**: 소수 기반 엇갈린 리셋

```python
심판 A: 3, 8, 13, 18, 23... (3 + 5k)
심판 B: 5, 10, 15, 20, 25... (5k)

→ 동시 리셋 최소화
→ 지속적 감시 보장
```

### 3. 순차적 증거 공개

```
Stage 1: 관찰 가능한 증거
  → 누구나 볼 수 있는 현상

Stage 2: 역사적/고대 증거
  → 오래된 측정과 관찰

Stage 3: 현대 과학적 증거
  → 정밀한 측정과 실험

Stage 4: 우주 시대 확증
  → 최신 기술과 직접 관찰
```

**효과**: 정보 부족 → 풍부의 과정에서 논리가 어떻게 발전하는지 학습

---

## 💻 설치 및 실행

### 설치

```bash
# 저장소 클론
git clone https://github.com/yourusername/proven-fact-algorithm.git
cd proven-fact-algorithm

# 패키지 설치
pip install -r requirements.txt

# API 키 설정
export ANTHROPIC_API_KEY="your-key"
# 또는
export OPENAI_API_KEY="your-key"
```

### 기본 실행

```bash
# 지구 자전 시뮬레이션 (논문 재현)
python run_proven_fact.py --template earth_rotation --sessions 12

# 지구 구형 시뮬레이션
python run_proven_fact.py --template earth_sphericity --sessions 15

# 진화론 시뮬레이션
python run_proven_fact.py --template evolution --sessions 15

# 기후변화 시뮬레이션
python run_proven_fact.py --template climate_change --sessions 15
```

### 결과 분석

```bash
# 결과 파일 분석
python analyze_proven_fact.py earth_rotation_results.json

# 생성되는 파일들:
# - summary.txt (통계 요약)
# - session_table.csv (세션별 표)
# - hallucination_trend.png (환각률 추이 그래프)
# - stage_comparison.png (단계별 비교)
# - reasoning_paths.json (A-B-C 추론 경로)
```

---

## 🔧 사용자 정의 시뮬레이션

### JSON 설정 파일 생성

```json
{
  "proven_fact": "입증된 과학적 사실",
  "topic": "학습 주제",
  "evidence_stages": [
    ["1단계 증거들..."],
    ["2단계 증거들..."],
    ["3단계 증거들..."],
    ["4단계 증거들..."]
  ]
}
```

### 예제: 백신 효능

```json
{
  "proven_fact": "백신은 면역 체계를 훈련시켜 특정 병원체를 인식하고 퇴치하도록 하여 수백만 명의 생명을 구했습니다.",
  "topic": "백신의 작동 원리와 역사적 영향",
  "evidence_stages": [
    [
      "에드워드 제너의 우두 실험 (1796)이 천연두를 예방",
      "천연두는 20세기에만 3억 명을 사망시킴",
      "관찰: 백신 접종자가 질병 발병에 저항성을 보임"
    ],
    [
      "루이 파스퇴르가 약독화 바이러스 원리로 광견병 백신 개발 (1885)",
      "소아마비 발생률이 백신 도입 후 99% 감소 (1955)",
      "홍역 사례가 연간 300-400만 건에서 거의 제거됨"
    ],
    [
      "임상 시험에서 대부분의 현대 백신이 90-95% 효능 입증",
      "집단 면역 임계값 계산이 역학 모델과 일치",
      "백신 접종 후 항체 역가가 측정 가능하게 증가",
      "역사적 데이터: 백신 접종률이 높은 지역에서 질병 제거"
    ],
    [
      "mRNA 백신 기술 (COVID-19)이 신속한 개발 능력 입증",
      "유전자 염기서열 분석으로 백신 유도 항체가 표적 병원체와 일치함을 확인",
      "전 세계 백신 캠페인으로 천연두 박멸 (1980), 소아마비 거의 제거",
      "실시간 감시 데이터가 백신 접종률과 질병 감소 간 상관관계 보여줌"
    ]
  ]
}
```

### 실행

```bash
python run_proven_fact.py --config vaccine_config.json --sessions 12
```

---

## 📊 상세 분석

### 1. 세션별 환각률 추적

```python
from analyze_proven_fact import ProvenFactAnalyzer

analyzer = ProvenFactAnalyzer("results.json")
df = analyzer.generate_session_table()

print(df)
#   Round  Total Sentences  Hallucinations  Rate
#   1      16              0               0.00%
#   2      15              0               0.00%
#   ...
```

### 2. 증거 단계별 성능

```python
stage_df = analyzer.analyze_evidence_stages()

# Stage 1 (적은 증거): 환각률 높을 수 있음
# Stage 4 (많은 증거): 환각률 낮음
```

### 3. 인과 추론 경로 추출

```python
paths = analyzer.extract_reasoning_paths()

# 예시 출력:
# {
#   "session": 5,
#   "explanation": "지구가 둥글기 때문에 배가 수평선 너머로 사라질 때...",
#   "pattern": "A is B because C"
# }
```

### 4. 잔여 환각 분석

```python
residual = analyzer.analyze_residual_hallucinations()

# 논문 4번째 실험에서 발견된 것처럼
# 단위 불일치 (km vs li) 등을 포착
```

---

## 🎓 논문 재현 가이드

### 실험 1: 지구 자전 (ChatGPT)

```bash
python run_proven_fact.py \
    --template earth_rotation \
    --provider openai \
    --sessions 12 \
    --output earth_rotation_gpt.json

python analyze_proven_fact.py earth_rotation_gpt.json
```

**예상 결과**: 
- 총 문장: ~190
- 환각: 0
- 환각률: **0.00%**

### 실험 2: 지구 자전 (Claude)

```bash
python run_proven_fact.py \
    --template earth_rotation \
    --provider anthropic \
    --sessions 12 \
    --output earth_rotation_claude.json
```

**예상 결과**:
- 총 문장: ~530
- 환각: 0
- 환각률: **0.00%**

### 실험 3: 지구 구형 (ChatGPT)

```bash
python run_proven_fact.py \
    --template earth_sphericity \
    --provider openai \
    --sessions 15 \
    --output earth_sphericity_gpt.json
```

**예상 결과**:
- 총 문장: ~316
- 환각: 0
- 환각률: **0.00%**

### 실험 4: 지구 구형 (Claude)

```bash
python run_proven_fact.py \
    --template earth_sphericity \
    --provider anthropic \
    --sessions 15 \
    --output earth_sphericity_claude.json
```

**예상 결과** (논문과 동일):
- 총 문장: ~220
- 환각: 4 (단위 오류)
- 환각률: **1.8%**

**발견된 문제**: 
- 교수가 "40,000 리(li)"라고 했어야 할 것을 "40,000 km"로 표기
- 심판이 단위 불일치를 놓침
- 해결책: 심판 프롬프트에 단위 검증 강화

---

## 💡 핵심 기능 설명

### 1. Anchor (앵커) - 진리의 고정점

```python
proven_fact = "지구는 24시간마다 자전축을 중심으로 회전하여 낮과 밤을 만듭니다."

# 이것이 시스템의 "북극성"
# 모든 논의는 이 진리로부터 시작하고 이를 증명
```

### 2. 차등 엄격성 (Differential Strictness)

```python
# 교수 발언 검증
- 모든 숫자 확인
- 모든 단위 확인
- 모든 고유명사 확인
- 미세 오류도 즉시 수정

# 학생 발언 검증
- 질문과 의심 허용
- 반증 불가능 가설 차단
- 수정 시 명시적 철회 요구
```

### 3. 실시간 개입 (Real-time Intervention)

```python
# 기존 방법: 사후 검증
생성 → 완료 → 검증 → 수정

# 이 방법: 실시간 검증
생성 → 심판 확인 → 즉시 수정 → 계속
       ↑
     오류 전파 차단
```

### 4. 인과 경로 문서화

```python
# 단순 사실 학습
"지구는 둥글다" ✗

# 인과 관계 학습
"현상(A): 배가 수평선 너머로 사라질 때 선체부터 사라진다
결론(B): 지구가 둥글기 때문이다
증거(C): 빛은 직선으로 이동하므로 곡면이 하부를 먼저 가린다" ✓

→ AI 재학습 데이터: "A는 B이다. 왜냐하면 C이기 때문"
```

---

## 🔍 문제 해결 및 개선

### 논문에서 발견된 문제들

#### 1. 단위 불일치 (1.8% 환각의 원인)

**문제**:
```
교수: "에라토스테네스는 지구 둘레를 40,000 리로 측정했다"
실제: 40,000 km (현대 단위)와 혼동

심판이 놓침 → 1.8% 환각률
```

**해결책**:
```python
# 심판 프롬프트 강화
"Check ALL units meticulously:
- Ancient units (stadia, li, cubits)
- Modern units (km, m, miles)
- NEVER mix ancient and modern measurements
- Flag ANY unit inconsistency immediately"
```

#### 2. 미완성 인정 (Incomplete Acknowledgment)

**문제**:
```
학생: "주천원 이론이 더 정확할 수 있다"
교수: [물리적 증거 제시]
학생: [더 이상 언급 안 함]

하지만 명시적 철회는 없음 → 잠재적 노이즈
```

**해결책**:
```python
# 학생 프롬프트 강화
"When convinced by evidence, you MUST explicitly state:
'I acknowledge [claim] is correct and withdraw my objection to [previous argument].'"
```

#### 3. 반증 불가능 가설

**문제**:
```
학생: "현대 기술도 조작될 수 있다"
→ 반증 불가능 → 논리적으로 대응 어려움
```

**해결책**:
```python
# 심판이 즉시 차단
"Unfalsifiable hypothesis detected. This violates logical debate rules."
```

### 개선 권장사항

#### 1. 높은 환각률 시 자동 리셋

```python
if session_hallucination_rate > 0.50:
    reset_high_error_agents()
    print("⚠️ High error rate - resetting agents")
```

#### 2. 도메인별 검증자

```python
# 의료 시뮬레이션
validator = MedicalFactValidator()
validator.check_drug_names()
validator.check_dosages()
validator.check_contraindications()
```

#### 3. 다중 심판 교차 검증

```python
# 3명 이상의 심판 사용
if len([r for r in referees if r.detected_error]) >= 2:
    # 2명 이상이 동의하면 확정
    confirm_hallucination()
```

---

## 📈 비용 및 성능

### API 비용 추정

| 실험 유형 | 세션 수 | 예상 비용 (Anthropic) | 예상 비용 (OpenAI) |
|----------|--------|---------------------|-------------------|
| 기본 (12 세션) | 12 | $2-3 | $3-4 |
| 확장 (15 세션) | 15 | $3-4 | $4-6 |
| 종합 (30 세션) | 30 | $6-8 | $8-12 |

### 실행 시간

- 세션당 평균: 30-60초
- 12 세션: 6-12분
- 15 세션: 8-15분
- 30 세션: 15-30분

### 품질 vs 비용

```
기존 방법:
- 비용: $0.10 (단순 생성)
- 환각률: 15-30%
- 재학습 가능성: 낮음

이 방법:
- 비용: $2-8 (12-30 세션)
- 환각률: 0-1.8%
- 재학습 가능성: 매우 높음

→ 비용 20-80배 높지만 품질 95%+ 향상
```

---

## 🎯 적용 분야

### 1. AI 재학습 데이터 생성

```python
# 고순도 인과 추론 데이터셋
→ GPT, Claude 등의 파인튜닝
→ 환각 감소 모델 개발
```

### 2. 교육용 AI 개발

```python
# "왜?"에 답할 수 있는 AI
→ 단순 답변이 아닌 설명 제공
→ 학습자의 의심에 논리적 대응
```

### 3. 사실 검증 시스템

```python
# 주장의 논리적 분해
→ 증거 기반 검증
→ 인과 관계 확인
```

### 4. 과학 지식 큐레이션

```python
# 복잡한 도메인에서 입증 가능한 사실 추출
→ 의료, 법률, 과학 분야
→ AI 학습용 고품질 데이터
```

---

## 🚀 다음 단계

### 즉시 실행 가능

1. **논문 재현**
   ```bash
   # 4개 실험 모두 실행
   ./reproduce_all_experiments.sh
   ```

2. **자신의 주제로 실험**
   ```bash
   # JSON 설정 만들고 실행
   python run_proven_fact.py --config my_topic.json
   ```

3. **결과 분석 및 시각화**
   ```bash
   python analyze_proven_fact.py results.json
   ```

### 개선 작업

1. **단위 검증 강화**
   - 심판 프롬프트에 단위 체크 명시
   - 단위 변환 테이블 제공

2. **명시적 철회 강제**
   - 학생이 수정 시 반드시 철회문 생성
   - 심판이 철회 여부 확인

3. **도메인 특화**
   - 의료, 법률, 과학별 검증자
   - 전문 용어 사전 통합

---

## 📚 참고 자료

### 관련 논문

- **STaR**: Self-Taught Reasoner
- **Constitutional AI**: Anthropic
- **MAD**: Multi-Agent Debate
- **Reverse Curriculum Learning**

### 이 시스템의 차별점

| 기능 | STaR | MAD | 이 시스템 |
|-----|------|-----|---------|
| 실시간 검증 | ❌ | ❌ | ✅ |
| 인과 추론 (A→B→C) | ❌ | ❌ | ✅ |
| 비동기 리셋 | ❌ | ❌ | ✅ |
| 순차적 증거 | ❌ | ❌ | ✅ |
| 최종 감사 | ❌ | ❌ | ✅ |
| 환각률 | ~5-10% | ~3-5% | **0-1.8%** |

---

## ✅ 체크리스트

### 설치
- [ ] Python 3.8+ 설치
- [ ] pip install -r requirements.txt
- [ ] API 키 설정
- [ ] 테스트 실행 성공

### 논문 재현
- [ ] 지구 자전 (GPT) - 0% 환각
- [ ] 지구 자전 (Claude) - 0% 환각
- [ ] 지구 구형 (GPT) - 0% 환각
- [ ] 지구 구형 (Claude) - 1.8% 환각

### 사용자 정의
- [ ] JSON 설정 파일 작성
- [ ] 자신의 주제로 실험
- [ ] 결과 분석 및 시각화

### 개선
- [ ] 단위 검증 강화
- [ ] 명시적 철회 구현
- [ ] 도메인 특화 검증자 추가

---

## 📞 문의

- GitHub Issues: [링크]
- 이메일: [이메일]

---

**결론**: 이 시스템은 기존 방법 대비 20-80배의 비용이 들지만, 95%+ 환각 감소를 달성합니다. 고품질 AI 재학습 데이터가 필요한 경우 최적의 선택입니다.

**행운을 빕니다!** 🍀
